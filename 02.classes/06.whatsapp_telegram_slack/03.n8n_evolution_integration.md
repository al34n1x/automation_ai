# ü§ñ README ‚Äî Integraci√≥n de **n8n** con Evolution API (WhatsApp Agent)

Este documento gu√≠a, paso a paso, c√≥mo **integrar Evolution API con n8n** para comenzar a recibir mensajes de WhatsApp en un workflow automatizado.  

---

## üìå Prerrequisitos

- Evolution API ya desplegado y configurado (ej. en Railway) con una **instancia creada**.  
- `AUTHENTICATION_API_KEY` v√°lido para acceder al dashboard de Evolution API.  
- Acceso a un servidor de **n8n** (cloud o self-hosted).  
- N√∫mero de WhatsApp disponible para vincular.  

---

## üõ†Ô∏è Pasos de integraci√≥n

### 1) Crear un nuevo workflow en n8n
- Inicia sesi√≥n en tu panel de **n8n**.  
- Haz clic en **‚ÄúNew Workflow‚Äù** para crear un flujo desde cero.  
- Dale un nombre descriptivo (ejemplo: `whatsapp_inbound_bot`).  

---

### 2) Agregar un nodo **Webhook** como trigger
- Dentro del editor de workflow, arrastra un nodo **Webhook**.  
- Este ser√° el **punto de entrada** donde Evolution API enviar√° los mensajes entrantes de WhatsApp.  

---

### 3) Configurar el nodo Webhook
Abre el nodo **Webhook** y realiza los siguientes ajustes:

- **Method**: `POST`  
  > Evolution API enviar√° mensajes en formato HTTP POST.  

- **Path**: `/bot`  
  > La ruta que escuchar√° n8n. El endpoint quedar√° accesible en:  
  > `https://<tu-url>/webhook/bot`  

- **Authentication**: `None`  
  > ‚ö†Ô∏è Solo para entornos de desarrollo. En producci√≥n, habilit√° alg√∫n mecanismo de autenticaci√≥n (ej: API Key o Basic Auth).  

- **Respond**: `Immediately`  
  > Esto asegura que n8n responda r√°pidamente (200 OK) y no se corte la conexi√≥n con Evolution API.  

---

#### Copiar la Production URL
- Haz clic en la pesta√±a **Production URL**.  
- Copia el enlace generado, que tendr√° el formato: `https://<tu-url-de-n8n>/webhook/bot` 


üëâ Este ser√° el endpoint que pegaremos en Evolution API.

---

### 4) Configurar Webhook en Evolution API
- Regresa al **dashboard de Evolution API**.  
- En el men√∫ lateral, despliega **Events** ‚Üí selecciona **Webhook**.  

---

### 5) Pegar la URL del Webhook de n8n
- En el campo **URL**, pega la **Production URL** copiada desde n8n.  
- Ejemplo:  `https://mi-servidor-n8n.app/webhook/bot`


---

### 6) Habilitar eventos relevantes
- Desplaza hacia abajo hasta la secci√≥n de **eventos**.  
- Activa la opci√≥n **`MESSAGES_UPSERT`**.  
- Esta opci√≥n env√≠a a tu webhook cada vez que se recibe un **nuevo mensaje en WhatsApp**.  

> üìå Dependiendo del caso de uso, pod√©s habilitar m√°s eventos:  
> - `MESSAGES_UPDATE` ‚Üí cambios de estado en mensajes  
> - `CONTACTS_SET` ‚Üí actualizaciones en contactos  
> - `GROUPS_UPSERT` ‚Üí eventos de grupos  
>  
> Para este laboratorio, solo necesitamos **`MESSAGES_UPSERT`**.

---

### 7) Vincular WhatsApp con Evolution API
- Desde el **Dashboard principal** de Evolution API, hac√© clic en **Get QR Code**.  
- Se mostrar√° un **QR din√°mico** en pantalla.  

---

### 8) Escanear el QR Code
- Abre la app de **WhatsApp** en tu tel√©fono.  
- Ve a **Men√∫ ‚Üí Dispositivos vinculados ‚Üí Vincular un dispositivo**.  
- Escane√° el QR desde el dashboard de Evolution API.  

---

### 9) Confirmar la conexi√≥n
- Luego de unos segundos, la sesi√≥n aparecer√° como **Conectada** en Evolution API.  
- Tu n√∫mero de WhatsApp ahora est√° vinculado a la API y listo para enviar/recibir mensajes v√≠a n8n.  

---

### 10) Volver a n8n para continuar con el workflow
- Con el Webhook ya conectado, pod√©s:  
- A√±adir un **nodo ‚ÄúSet‚Äù** para manipular datos del mensaje.  
- Conectar con **Gmail**, **Google Sheets**, **APIs externas** o incluso **LLMs**.  
- Cada vez que recibas un mensaje de WhatsApp, n8n lo procesar√° autom√°ticamente.  

---

## ‚úÖ Resultado esperado
- Un flujo en **n8n** que recibe mensajes entrantes de WhatsApp v√≠a Evolution API.  
- Evolution API enviando todos los **eventos de nuevos mensajes (`MESSAGES_UPSERT`)** al webhook configurado.  
- Una sesi√≥n de WhatsApp conectada y operativa.  

---

## üöÄ Pr√≥ximos pasos
- Procesar mensajes entrantes con IA (ej: ChatGPT, RAG).  
- Conectar con un **CRM** para guardar conversaciones.  
- Responder autom√°ticamente usando un nodo **HTTP Request** hacia la API de Evolution.  
- Crear flujos multi-canal combinando WhatsApp con Telegram, Slack o correo.  

> Ahora sigue con el m√≥dulo de desarrollo del flujo de n8n!

---

[‚¨Ö n8n Whatsapp Workflow](./04.n8n_workflow.md)
[‚¨Ö Back to Course Overview](../../README.md)