# ‚öôÔ∏è README ‚Äî Configuraci√≥n de una **Instancia** en Evolution API (post‚Äëdespliegue en Railway)

Este documento gu√≠a, paso a paso y con contexto, c√≥mo **crear y configurar una instancia** dentro del panel de **Evolution API** (una vez que ya ten√©s el servicio corriendo en Railway). Est√° pensado para que la audiencia entienda **qu√© hace cada ajuste** y c√≥mo verificar que qued√≥ bien aplicado.

---

## üìå Prerrequisitos

- Evolution API **desplegado y accesible** (por ejemplo, en Railway con un dominio p√∫blico).
- Poder **iniciar sesi√≥n** en el panel de Evolution API con tu `AUTHENTICATION_API_KEY`.
- Tu n√∫mero de WhatsApp **ya vinculado** a Evolution API (sesi√≥n activa), o plan de vincularlo luego.

---

## üß≠ Conceptos r√°pidos

- **Instancia**: es el ‚Äúcontenedor l√≥gico‚Äù que agrupa la configuraci√≥n y el token propio para interactuar con tu sesi√≥n de WhatsApp a trav√©s de la API.
- **Channel**: define el ‚Äúcanal/driver‚Äù que usa Evolution API para conectarse (generalmente WhatsApp). Suele venir bien por defecto.
- **Token (de instancia)**: credencial **espec√≠fica de esa instancia** para autenticar peticiones a sus endpoints.  
  > üîí **No confundir** con `AUTHENTICATION_API_KEY` (clave global para entrar al panel).  
  > üîê Guard√° tu token de instancia en un lugar seguro.

---

## üõ†Ô∏è Pasos de configuraci√≥n (detallados)

### 1) Crear una nueva instancia
1. Inici√° sesi√≥n en el **dashboard de Evolution API**.
2. Entr√° a la secci√≥n **Instances** (o similar) y hac√© clic en **New Instance** / **Create**.
3. Se abrir√° un formulario con los campos b√°sicos.

> üìù **¬øPor qu√© una nueva instancia?**  
> Te permite separar l√≥gicas, tokens y configuraciones. Por ejemplo, podr√≠as tener una instancia para **soporte**, otra para **marketing**, etc.

---

### 2) Dale un nombre
- En el campo **Name**, ingres√° un identificador claro, por ejemplo:  
  - `soporte_whatsapp`  
  - `ventas_latam`  
  - `mi_agente_whatsapp`
- Recomendaciones:
  - Evit√° espacios y caracteres raros.
  - Us√° un nombre que describa prop√≥sito/√°rea (facilita el mantenimiento).

---

### 3) Dej√° la opci√≥n `channel` y `token` con sus valores por defecto
- **Channel**: dejalo en el valor por defecto (suele apuntar al canal de WhatsApp correcto para el driver configurado).
- **Token**: si el panel lo **autogenera por defecto**, **no lo cambies** salvo que tengas un sistema de gesti√≥n de secretos propio.
- **number**: Dejalo vac√≠o. Esto significa que la instancia no est√° vinculada a ning√∫n n√∫mero espec√≠fico.
  - **Ventajas de defaults**: menos fricci√≥n, valores compatibles con la instalaci√≥n base.
  - M√°s adelante, si lo necesit√°s, pod√©s **rotar el token** de instancia o asignar uno expl√≠cito.

> ‚ö†Ô∏è **Buenas pr√°cticas de seguridad**  
> - No compartas el token de instancia en capturas, repos o chats.  
> - Si sospech√°s exposici√≥n, **rotalo** y actualiz√° tus integraciones.

---

### 4) Una vez creada la instancia, seleccion√° el √≠cono de **configuraci√≥n**
- Guard√° la instancia.
- En el listado de instancias, ubic√° la que acab√°s de crear.
- Hac√© clic en el **√≠cono de engranaje** (configuraci√≥n) o en **View / Settings** para abrir sus opciones.

> üí° **Tip**: Si ten√©s varias instancias, marc√° como ‚Äúfavorita‚Äù o document√° su URL para ir directo.

---

### 5) En el dashboard de la instancia, entr√° a **Configurations** y habilit√° estas opciones

#### ‚úÖ Reject Calls
- **Qu√© hace**: bloquea **llamadas de voz/video** entrantes.  
- **Por qu√© activarlo**: los agentes conversacionales no atienden llamadas; esto evita interrupciones y potenciales abusos.  
- **Efecto esperado**: cuando alguien intente llamar, se **rechaza** autom√°ticamente (seg√∫n el driver).

#### ‚úÖ Ignore Groups
- **Qu√© hace**: **ignora mensajes de grupos** (no se procesan ni disparan webhooks).  
- **Por qu√© activarlo**: para entornos de producci√≥n/soporte 1:1 suele ser preferible mantener comunicaci√≥n directa.  
- **Efecto esperado**: si te agregan a un grupo o te escriben desde uno, tu agente **no** responder√° ni registrar√° esos mensajes.

> ‚ÑπÔ∏è **Nota**: Puede que a√∫n te puedan **agregar** a grupos desde WhatsApp, pero la **instancia no procesar√°** esos mensajes mientras esta opci√≥n est√© activa.

#### üü¶ Read Messages (opcional)
- **Qu√© hace**: env√≠a acuses de lectura (el ‚Äúdoble tilde azul‚Äù) una vez que tu agente procese el mensaje.  
- **Cu√°ndo activarlo**: si quer√©s **experiencia de ‚Äúmensaje le√≠do‚Äù** para el usuario final.  
- **Consideraciones**: habilitarlo puede modificar la percepci√≥n de SLA (el usuario asume que fue le√≠do ‚Äúpor humano‚Äù).

> üîß Despu√©s de activar/desactivar cada toggle, **hac√© clic en `Save`**.

---

## üîç Verificaci√≥n r√°pida (checklist)

1. **Reject Calls** activo: ped√≠ a alguien que intente **llamarte por WhatsApp**. Deber√≠a **rechazar** la llamada.
2. **Ignore Groups** activo: ped√≠ que te agreguen a un **grupo** y env√≠en un mensaje. Tu instancia **no** deber√≠a responder ni disparar webhooks.
3. **Read Messages**:
   - **ON**: al recibir un mensaje 1:1, el remitente ve el **doble tilde azul** luego de procesado.  
   - **OFF**: el remitente **no** ve le√≠do (se mantiene doble tilde gris si entregado).

> üß™ Tambi√©n pod√©s revisar **logs** o tu **webhook** (si lo ten√©s configurado) para comprobar el comportamiento.

---

## üßØ Resoluci√≥n de problemas

- **No se guardan los cambios**  
  - Verific√° que hiciste clic en **Save** y actualiz√° el navegador.  
  - Cheque√° si hay errores de permisos o sesi√≥n expirada (volv√© a iniciar sesi√≥n).

- **Sigue procesando mensajes de grupos**  
  - Confirm√° que **Ignore Groups** qued√≥ en **ON** y guardado.  
  - Si us√°s varias instancias, asegurate de probar en la **instancia correcta**.

- **Read receipts no aparecen**  
  - Verific√° que **Read Messages** est√© en **ON** y que el mensaje sea 1:1 (no grupo).  
  - Asegurate de que la sesi√≥n de WhatsApp est√© **conectada** y sin problemas en el tel√©fono (bater√≠a, conectividad).

- **Llamadas no se rechazan**  
  - Asegurate de que **Reject Calls** est√© **ON** y guardado.  
  - Record√° que el comportamiento exacto puede depender del driver/canal.

---

## üõ°Ô∏è Buenas pr√°cticas

- **Separ√° instancias por dominio** (soporte, ventas, campa√±as) para aislar reglas y tokens.
- **Document√°** qu√© toggles est√°n activos en cada instancia y **por qu√©**.
- **Rot√° tokens** peri√≥dicamente y almacenalos en un **vault** (no en texto plano).
- Manten√© tu tel√©fono principal **conectado y estable** (WhatsApp requiere vinculaci√≥n y conectividad).

---

## üöÄ Pr√≥ximos pasos

- Configurar **Webhooks** de la instancia para integrar con **n8n** u otros orquestadores.
- Crear reglas de auto‚Äërespuesta y flujos (FAQ, clasificaci√≥n de intenci√≥n, enrutamiento).
- A√±adir **observabilidad** (logs + m√©tricas) para ver salud, tasas de entrega y tiempos de respuesta.

---

## ‚úÖ Resumen de acciones (versi√≥n ‚Äúchecklist‚Äù)

- [ ] Crear **nueva instancia**  
- [ ] **Nombrarla** claramente  
- [ ] Dejar **`channel`** y **`token`** en **default**  
- [ ] Abrir **configuraci√≥n** (√≠cono de engranaje)  
- [ ] En **Configurations**:  
  - [ ] **Reject Calls** ‚Üí **ON**  
  - [ ] **Ignore Groups** ‚Üí **ON**  
  - [ ] **Read Messages** ‚Üí **(opcional) ON**  
- [ ] **Save** y **probar** comportamiento

> Ahora sigue con el m√≥dulo de integraci√≥n con n8n!

---

[‚¨Ö n8n - Evolution API integration](./03.n8n_evolution_integration.md)

[‚¨Ö Back to Course Overview](../../README.md)